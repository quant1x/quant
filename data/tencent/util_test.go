package tencent

import (
	"fmt"
	"github.com/quant1x/quant/stock"
	"regexp"
	"strings"
	"testing"
)

const (
	//EXP_REAL_TIME string = "^[0-9a-zA-Z_-+=]+\"(.*)\";$"
	EXP_REAL_TIME string = `[^\"]*\"(.*)\";$`
	//EXP_REAL_TIME0 string = `[^\"]*\"(.*)\"`
	EXP_REAL_TIME0 string = `([^v_\"]+)=\"([^\"]+)\";`
)

func Test_realTimeData1(t *testing.T) {
	var strResult string = `v_sz000858="51~五 粮 液~000858~100.23~95.40~94.66~516297~298676~217371~100.22~829~100.20~36~100.17~1~100.16~53~100.15~78~100.23~907~100.24~2~100.25~236~100.26~709~100.27~42~15:00:04/100.23/5273/S/52851279/16379|14:57:00/100.26/307/S/3079024/16256|14:56:57/100.30/94/B/942728/16252|14:56:54/100.30/67/M/672105/16248|14:56:51/100.30/71/S/712165/16244|14:56:49/100.30/72/B/722068/16242~20190404153005~4.83~5.06~101.53~94.19~100.23/516297/5094805405~516297~509481~1.36~29.07~~101.53~94.19~7.69~3804.50~3890.54~6.13~104.94~85.86~1.11~-899~98.71~29.07~29.07~~~1.33";`
	fullCode := strResult[2:10]
	fmt.Println(fullCode)
	r, _ := regexp.Compile(EXP_REAL_TIME)
	arr := r.FindStringSubmatch(strResult)
	//fmt.Println(arr[1]) //true
	text := arr[1]
	vas := strings.Split(text, "~")
	fmt.Printf("%+v\n", vas)
}

func Test_realTimeData2(t *testing.T) {
	var api stock.StockApi
	ts := &TencentStock{}
	api = ts
	rt, err := api.RealTime0("sz000858")
	if err != nil {
		fmt.Println(err)
	} else {
		fmt.Printf("%+v\n", rt)
	}
}

func Test_realTimeData(t *testing.T) {
	//var api stock.StockApi
	//ts := &TencentStock{}
	//api = ts
	code := "sh600600"
	//rt, err := api.RealTime("sh600600")
	rt , err := query(code)
	if err != nil {
		fmt.Println(err)
	} else {
		fmt.Printf("%+v\n", rt)
	}
}

func TestParaseRealtimeData(t *testing.T) {
	s := `
v_sh600519="1~贵州茅台~600519~1749.79~1768.90~1810.01~63864~27117~36747~1749.00~6~1746.02~1~1746.00~27~1745.99~29~1745.98~6~1749.79~85~1749.80~1~1749.90~7~1749.94~2~1749.95~1~~20210729155949~-19.11~-1.08~1823.00~1734.34~1749.79/63864/11299569857~63864~1129957~0.51~46.22~~1823.00~1734.34~5.01~21980.82~21980.82~14.55~1945.79~1592.01~0.89~-27~1769.32~39.38~47.07~~~1.30~1129956.9857~0.0000~0~ ~GP-A~-11.57~-9.81~1.10~27.13~23.43~2608.59~1579.21~-12.42~-16.87~-11.96~1256197812~1256197812~-16.36";
v_sz300011="51~鼎汉技术~300011~6.13~5.72~5.79~140528~87264~53263~6.13~26~6.12~22~6.11~23~6.10~495~6.09~166~6.14~510~6.15~1210~6.16~1903~6.17~82~6.18~231~~20210729161503~0.41~7.17~6.20~5.78~6.13/140528/84814294~140528~8481~2.88~-7.88~~6.20~5.78~7.34~29.93~34.25~2.31~6.86~4.58~1.28~-3204~6.04~98.21~-7.29~~~0.81~8481.4294~0.0000~0~ A~GP-A-CYB~-9.72~-4.81~0.00~-29.37~-13.67~9.10~4.67~2.51~11.66~23.34~488262930~558650391~-68.64";
v_hk00700="100~腾讯控股~00700~492.000~447.200~480.000~72896321.0~0~0~492.000~0~0~0~0~0~0~0~0~0~492.000~0~0~0~0~0~0~0~0~0~72896321.0~2021/07/29 16:08:12~44.800~10.02~494.200~468.600~492.000~72896321.0~35108302945.350~0~24.85~~0~0~5.72~47231.7664~47231.7664~TENCENT~0.33~773.900~422.000~1.09~-19.11~0~0~0~0~0~22.16~5.15~0.76~100~-12.52~-9.56~GP~3.63~1.96";
`
	r, _ := regexp.Compile(EXP_REAL_TIME0)
	arr := r.FindAllStringSubmatch(s, -1)
	text := arr[0][2]
	vas := strings.Split(text, "~")
	fmt.Printf("%+v\n", vas)
}