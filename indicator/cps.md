X_RCLOSE:=DYNAINFO(3);
X_HIGH:=DYNAINFO(5);
X_LOW:=DYNAINFO(6);
X_12:=MAX(X_RCLOSE,X_HIGH);
X_13:=MIN(X_RCLOSE,X_LOW);
X_14:=X_12-X_13;
X_15:X_13+X_14*8/9,COLORLIRED,DOTLINE;
X_16:X_13+X_14*0.5/9,COLORGREEN,DOTLINE;
X_18:=(EMA(CLOSE,12)-EMA(CLOSE,26))+X_RCLOSE;
X_19:=EMA(X_18,9);
X_20:=10*(X_18-X_19);
X_21:=EMA(X_20,2);
X_22:=SUM(AMOUNT,BARSCOUNT(CLOSE))/SUM(V*100,BARSCOUNT(CLOSE));
X_23:=EXPMA(CLOSE/X_22,20);
DRAWTEXT(CROSS(X_23,1.02),C*0.999,' 拉'),COLORMAGENTA,LINETHICK9;
DRAWICON(CROSS(X_23,1.04),C,45);
DRAWTEXT(CROSS(X_23,1.04),C*0.999,' 冲'),COLORRED,LINETHICK9;
B:=LONGCROSS(X_16,C,2);
XN:=BARSCOUNT(CLOSE>0);
BC:=COUNT(B,XN);
MCMR:=STRCAT('满仓买入:',CON2STR(BC,0));
DRAWTEXT(B,C-0.01,MCMR),COLORYELLOW,LINETHICK9;
DRAWICON(B,C-0.01,1);
STICKLINE(B,C,X_15,0,-1),COLORCYAN;
DRAWTEXT(LONGCROSS(C,X_15,2),C+0.01,'卖出'),COLORGREEN,LINETHICK9;

{A111:=(DVOL/C)/2,NODRAW;}
A111:=(VOL/C)/2,NODRAW;
A2:=SUM(IF(A111>100 AND CLOSE>REF(CLOSE,1),A111,0),0);
A3:=SUM(IF(A111>100 AND CLOSE<REF(CLOSE,1),A111,0),0);
A4:=SUM(IF(A111<100 AND CLOSE>REF(CLOSE,1),A111,0),0);
A5:=SUM(IF(A111<100 AND CLOSE<REF(CLOSE,1),A111,0),0);
A6:=A2+A3+A4+A5;
A7:=IF((BARSTATUS=2),((100*A2)/A6),0);
A8:=((IF((BARSTATUS=2),((100*A3)/A6),0)));
A9:=((IF((BARSTATUS=2),((100*A4)/A6),0)));
A10:=((IF((BARSTATUS=2),((100*A5)/A6),0)));
机构买盘:=(A2),LINETHICK2;
机构卖盘:=(A3),LINETHICK2;
散户买盘:=(A4);
散户卖盘:=(A5);
机构买:=(A2),LINETHICK6,COLORRED;
机构卖:=(A3),LINETHICK6,COLORGREEN;

机构买1:(100*A2)/A6,NODRAW,COLORRED;
机构卖1:(100*A3)/A6,NODRAW,COLORGREEN;
净买入1:(100*(A2-A3))/A6,NODRAW,COLORYELLOW;
DD11:=1;
{AAA1:=STRCAT(STRCAT('机构买',CON2STR((100*A2)/A6,0)),'%');
AAA2:=STRCAT(STRCAT('机构卖',CON2STR((100*A3)/A6,0)),'%');
AAA3:=STRCAT(STRCAT('净买入',CON2STR((100*(A2-A3))/A6,0)),'%');}

AAA1:=STRCAT(STRCAT('机构买',CON2STR(机构买1,0)),'%');
AAA2:=STRCAT(STRCAT('机构卖',CON2STR(机构卖1,0)),'%');
AAA3:=STRCAT(STRCAT('净买入',CON2STR(净买入1,0)),'%');

DRAWTEXT_FIX(DD11=1,0,0.04,0,AAA1),COLORRED;
DRAWTEXT_FIX(DD11=1,0,0.1,0,AAA2),COLORGREEN;
DRAWTEXT_FIX(DD11=1,0,0.15,0,AAA3),COLORYELLOW;

N:=5;
NN:=MIN(BARSCOUNT(C),N);
FF:=(C-REF(C,NN))/REF(C,NN);
STICKLINE(FF>0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORRED;
STICKLINE(FF<0,DYNAINFO(3),DYNAINFO(3)*(1+FF),0.5,0),COLORGREEN;

{价格高低差}
ST:="BASIC.X_HIGH#DAY" - "BASIC.X_LOW#DAY";
{平台}
PT:=REF(ST,1);
重心:=("BASIC.X_HIGH#DAY" + "BASIC.X_LOW#DAY" + "BASIC.X_CLOSE#DAY")/3;

{确定周期, 当日9点前取前一天的数据, 给当天操作提前下单做准备}
XS:=FROMOPEN;
CYCLE:=1;

{两条压力线}
YL01:=2*重心-"BASIC.X_LOW#DAY";
YL02:=重心+PT;
YL1:=IFF(YL01<YL02,YL01,YL02);
YL2:=IFN(YL01<YL02,YL01,YL02);
压2:REF(YL2, CYCLE),COLORLIRED,CROSSDOT;
压1:REF(YL1, CYCLE),COLORLIRED,CROSSDOT;

{两条支撑线}
ZC01:=2*重心-"BASIC.X_HIGH#DAY";
ZC02:=重心-PT;
ZC1:=IFF(ZC01>ZC02,ZC01,ZC02);
ZC2:=IFN(ZC01>ZC02,ZC01,ZC02);
支1:REF(ZC1, CYCLE),COLORGREEN,CROSSDOT;
支2:REF(ZC2, CYCLE),COLORGREEN,CROSSDOT;